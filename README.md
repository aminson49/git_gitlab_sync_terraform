# GitHub ↔ GitLab Sync (Terraform)

This repo helps keep a GitHub repo and a GitLab repo in sync. You fill in a few
values, run Terraform, and the plumbing gets created for you.

## How it works

Push to GitHub → Jenkins runs a sync job → GitLab updates.  
Push to GitLab → GitLab CI runs → GitHub updates.

## What Terraform creates

- A GitHub webhook to your Jenkins URL
- GitLab CI variables + `.gitlab-ci.yml`
- Optional Jenkins job + generated `Jenkinsfile` and `sync_repos.py`
- Optional auto-push of those generated files

## Prerequisites

- Terraform >= 1.0
- GitHub token with `repo` and `admin:repo_hook`
- GitLab token with `api`, `read_repository`, `write_repository`
- Jenkins (only for GitHub → GitLab sync)

## Setup (quick)

1. Copy the example file:
   ```
   cd terraform
   cp terraform.tfvars.example terraform.tfvars
   ```
2. Fill in your values in `terraform.tfvars`.
3. Run:
   ```
   terraform init
   terraform apply
   ```

## Repo format

- GitHub: `owner/repo`
- GitLab: `group/project`

## Test it

### GitHub → GitLab
1. Commit a small change in GitHub and push.
2. Jenkins job should run.
3. The file should show up in GitLab.

### GitLab → GitHub
1. Commit a small change in GitLab and push.
2. GitLab pipeline should run.
3. The file should show up in GitHub.

## Common gotchas

- `terraform.tfvars` has secrets. Do not commit it.
- Jenkins needs credentials to clone the GitHub repo.
- If you enable auto-push, your local git credentials must allow pushing.
- If you change Jenkins URL, update `jenkins_webhook_url` and re-apply.

## About generated files

- `Jenkinsfile` and `sync_repos.py` are generated by Terraform.
- To auto-push them, set `push_generated_files_enabled = true` and make sure
  your local git has push access.
